<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bilan de mati√®re ‚Äî Mini calc</title>
  <link rel="stylesheet" href="styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <h1>Bilan de mati√®re</h1>
    <p>Choisis une op√©ration unitaire (un seul appareil √† la fois).</p>
  </header>

  <main>
    <section class="card">
      <label for="unit">Op√©ration</label>
      <select id="unit">
        <option value="mixer">M√©langeur (n ‚Üí 1)</option>
        <option value="splitter">Diviseur (1 ‚Üí n)</option>
        <option value="binary-sep">S√©parateur binaire (type distillation)</option>
        <option value="rxn-simple">R√©acteur simple (1 r√©action)</option>
        <option value="rxn-multi">R√©actions multiples (ŒΩ-matrice)</option>
        <option value="flowsheet">Flowsheet Builder (multi-unit)</option>
      </select>
    </section>

    <!-- Composants -->
    <section class="card">
      <h2>Composants</h2>
      <div class="row">
        <input id="components" type="text" placeholder="Ex: A,B (s√©par√©s par des virgules)" value="A,B">
        <button id="applyComponents">Appliquer</button>
      </div>
      <small>Les fractions massiques/molaires saisies par courant doivent sommer √† 1.</small>
    </section>

    <!-- Mixer (n ‚Üí 1) -->
    <section class="card unit-panel" id="panel-mixer">
      <h2>M√©langeur (n ‚Üí 1)</h2>

      <div class="row" style="gap:12px;flex-wrap:wrap">
        <label>Nombre de feeds n</label>
        <input id="mixCount" type="number" min="2" step="1" value="2">
        <button id="buildMixerFeeds">Construire les feeds</button>
      </div>

      <div id="mixFeedsBox" class="mt"></div>

      <button class="primary" id="solveMixer">Calculer</button>
      <div class="result" id="mixResult"></div>
    </section>

    <!-- Splitter (1 ‚Üí n) -->
    <section class="card unit-panel" id="panel-splitter" hidden>
      <h2>Diviseur (1 ‚Üí n)</h2>
      <p>Hypoth√®se: compositions identiques sur toutes les branches.</p>

      <div class="grid2">
        <div>
          <h3>Feed</h3>
          <label>D√©bit F</label><input id="Fs" type="number" step="any">
          <div id="xsBox"></div>
        </div>

        <div>
          <h3>Branches</h3>
          <div class="row" style="gap:12px;flex-wrap:wrap">
            <label>Nombre de sorties n</label>
            <input id="splitCount" type="number" min="2" step="1" value="2">
            <button id="buildSplitterOuts">Construire les fractions œÜ<sub>i</sub></button>
          </div>
          <div id="splitPhiBox" class="mt"></div>
          <small>Les fractions œÜ<sub>i</sub> seront normalis√©es pour sommer √† 1.</small>
        </div>
      </div>

      <button class="primary" id="solveSplitter">Calculer</button>
      <div class="result" id="splitResult"></div>
    </section>

    <!-- Binary separator -->
    <section class="card unit-panel" id="panel-binary-sep" hidden>
      <h2>S√©parateur binaire (type distillation)</h2>
      <p>Mod√®le: bilans globaux + r√©cup√©ration du composant cl√© A dans le distillat.</p>
      <div class="grid2">
        <div>
          <h3>Alimentation</h3>
          <label>D√©bit F</label><input id="Ffeed" type="number" step="any">
          <label>z<sub>A</sub> (fraction)</label><input id="zA" type="number" step="any" placeholder="0‚Äì1">
        </div>
        <div>
          <h3>Sp√©cifications</h3>
          <label>R√©cup√©ration de A dans le distillat, R<sub>A</sub></label>
          <input id="RA" type="number" step="any" placeholder="0‚Äì1">
          <label>Donne UNE valeur (laisse les autres vides)</label>
          <div class="row" style="gap:8px; flex-wrap:wrap">
            <input id="D"   type="number" step="any" placeholder="D√©bit distillat D">
            <input id="xD"  type="number" step="any" placeholder="xD_A (0‚Äì1)">
            <input id="B"   type="number" step="any" placeholder="D√©bit r√©sidu B">
            <input id="xB"  type="number" step="any" placeholder="xB_A (0‚Äì1)">
          </div>
          <small>Le calcul utilisera l‚Äôunique valeur fournie avec F, z<sub>A</sub>, R<sub>A</sub>.</small>
        </div>
      </div>
      <button class="primary" id="solveBinSep">Calculer</button>
      <div class="result" id="binSepResult"></div>
    </section>

    <!-- Simple reaction -->
    <section class="card unit-panel" id="panel-rxn-simple" hidden>
      <h2>R√©acteur simple (1 r√©action)</h2>
      <p>√âquation: Œ£ ŒΩ<sub>j</sub>A<sub>j</sub> = 0 ; N<sub>out,j</sub> = N<sub>in,j</sub> + ŒΩ<sub>j</sub> Œæ</p>
      <div class="grid2">
        <div>
          <h3>Alimentation (molaire)</h3>
          <div id="NinBox"></div>
        </div>
        <div>
          <h3>St≈ìchiom√©trie</h3>
          <div id="nuBox"></div>
          <h3>Progression</h3>
          <div class="row">
            <input id="xi" type="number" step="any" placeholder="Œæ (si connu)">
            <input id="convKey" type="number" step="any" placeholder="Conversion du r√©actif cl√© Xc (0‚Äì1)">
            <select id="keyComp"></select>
          </div>
          <h3>Si Œæ et conversion sont vides</h3>
          <div class="row">
            <select id="specComp"></select>
            <input id="specNout" type="number" step="any" placeholder="N_out du composant choisi">
          </div>
          <small>Astuce: utilise un N_out pour d√©duire Œæ via N_out = N_in + ŒΩ¬∑Œæ.</small>
        </div>
      </div>
      <button class="primary" id="solveRxn">Calculer</button>
      <div class="result" id="rxnResult"></div>
      <label><input type="checkbox" id="atomCheck"> V√©rifier les bilans atomiques (optionnel)</label>
      <div id="atomicsBox" class="mt"></div>
    </section>

    <!-- Multiple reactions -->
    <section class="card unit-panel" id="panel-rxn-multi" hidden>
      <h2>R√©actions multiples (ŒΩ-matrice)</h2>
      <p>Test d‚Äôind√©pendance (rang de ŒΩ). Si ind√©pendant, calcul de N<sub>out</sub> et des fractions molaires.</p>
      <div class="grid2">
        <div>
          <h3>Alimentation (molaire)</h3>
          <div id="NinMultiBox"></div>
          <label>Nombre de r√©actions R</label>
          <input id="Rcount" type="number" step="1" min="1" value="2">
          <button id="buildNu" class="mt">Construire la matrice ŒΩ (R √ó S)</button>
        </div>
        <div>
          <h3>Matrice st≈ìchiom√©trique ŒΩ (r√©actions √ó esp√®ces)</h3>
          <div id="nuMultiBox"></div>
          <h3>Extents  Œæ<sub>k</sub></h3>
          <div id="xiBox"></div>

          <h3>Calculer Œæ automatiquement (optionnel)</h3>
          <label><input type="checkbox" id="autoXi"> Je veux fournir R sp√©cifications pour r√©soudre Œæ</label>
          <div id="autoXiBox" class="mt"></div>
        </div>
      </div>
      <button class="primary" id="solveRxnMulti">Tester l‚Äôind√©pendance & Calculer</button>
      <div class="result" id="rxnMultiResult"></div>
    </section>
    <!-- Flowsheet builder -->
    <section class="card unit-panel" id="panel-flowsheet" hidden>
      <h2>Flowsheet Builder</h2>
      <div class="row">
      <div id="toolbox" style="flex:0 0 150px; border:1px solid #ccc; padding:10px">
        <h3>Unit√©s</h3>
        <div class="draggable" draggable="true" data-type="mixer">‚ûï Mixer</div>
        <div class="draggable" draggable="true" data-type="splitter">‚ûó Splitter</div>
        <div class="draggable" draggable="true" data-type="binary-sep">‚öóÔ∏è Binaire</div>
        <div class="draggable" draggable="true" data-type="rxn-simple">üî• R√©acteur simple</div>
        <div class="draggable" draggable="true" data-type="rxn-multi">üî• R√©acteur multiple</div>
      </div>
      <div id="flowsheet" style="flex:1; border:1px dashed #aaa; min-height:400px; position:relative; margin-left:10px;">
        <p style="color:#777">Glisse-d√©pose des unit√©s ici</p>
      </div>
    </div>
    </section>

  </main>

  <footer>
    <small>EMI Process : Trust the process.</small>
  </footer>

  <script src="script.js"></script>
</body>
</html>
