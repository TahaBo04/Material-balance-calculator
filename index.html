<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bilan de matière — Mini calc</title>
  <link rel="stylesheet" href="styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <h1>Bilan de matière</h1>
    <p>Choisis une opération unitaire (un seul appareil à la fois).</p>
  </header>

  <main>
    <section class="card">
      <label for="unit">Opération</label>
      <select id="unit">
        <option value="mixer">Mélangeur (2 → 1)</option>
        <option value="splitter">Diviseur (1 → 2)</option>
        <option value="binary-sep">Séparateur binaire (type distillation)</option>
        <option value="rxn-simple">Réacteur simple (1 réaction)</option>
        <option value="rxn-multi">Réactions multiples (ν-matrice)</option>
      </select>
    </section>

    <!-- Composants -->
    <section class="card">
      <h2>Composants</h2>
      <div class="row">
        <input id="components" type="text" placeholder="Ex: A,B (séparés par des virgules)" value="A,B">
        <button id="applyComponents">Appliquer</button>
      </div>
      <small>Les fractions massiques/molaires saisies par courant doivent sommer à 1.</small>
    </section>

    <!-- Mixer -->
    <section class="card unit-panel" id="panel-mixer">
      <h2>Mélangeur (2 → 1)</h2>
      <div class="grid2">
        <div>
          <h3>Feed 1</h3>
          <label>Débit F1</label><input id="F1" type="number" step="any" placeholder="kg/h ou mol/h">
          <div id="x1Box"></div>
        </div>
        <div>
          <h3>Feed 2</h3>
          <label>Débit F2</label><input id="F2" type="number" step="any">
          <div id="x2Box"></div>
        </div>
      </div>
      <button class="primary" id="solveMixer">Calculer</button>
      <div class="result" id="mixResult"></div>
    </section>

    <!-- Splitter -->
    <section class="card unit-panel" id="panel-splitter" hidden>
      <h2>Diviseur (1 → 2)</h2>
      <p>Hypothèse: même composition dans toutes les branches.</p>
      <div class="grid2">
        <div>
          <h3>Feed</h3>
          <label>Débit F</label><input id="Fs" type="number" step="any">
          <div id="xsBox"></div>
        </div>
        <div>
          <h3>Spécifications</h3>
          <label>Fraction au débit vers le Courant 1, φ</label>
          <input id="phi" type="number" step="any" placeholder="0–1">
        </div>
      </div>
      <button class="primary" id="solveSplitter">Calculer</button>
      <div class="result" id="splitResult"></div>
    </section>

    <!-- Binary separator -->
    <section class="card unit-panel" id="panel-binary-sep" hidden>
      <h2>Séparateur binaire (type distillation)</h2>
      <p>Modèle: bilans globaux + récupération du composant clé A dans le distillat.</p>
      <div class="grid2">
        <div>
          <h3>Alimentation</h3>
          <label>Débit F</label><input id="Ffeed" type="number" step="any">
          <label>z<sub>A</sub> (fraction)</label><input id="zA" type="number" step="any" placeholder="0–1">
        </div>
        <div>
          <h3>Spécifications</h3>
          <label>Récupération de A dans le distillat, R<sub>A</sub></label>
          <input id="RA" type="number" step="any" placeholder="0–1">
          <label>Donne UNE valeur (laisse les autres vides)</label>
          <div class="row" style="gap:8px; flex-wrap:wrap">
            <input id="D"   type="number" step="any" placeholder="Débit distillat D">
            <input id="xD"  type="number" step="any" placeholder="xD_A (0–1)">
            <input id="B"   type="number" step="any" placeholder="Débit résidu B">
            <input id="xB"  type="number" step="any" placeholder="xB_A (0–1)">
          </div>
        </div>
      </div>
      <button class="primary" id="solveBinSep">Calculer</button>
      <div class="result" id="binSepResult"></div>
    </section>

    <!-- Simple reaction -->
    <section class="card unit-panel" id="panel-rxn-simple" hidden>
      <h2>Réacteur simple (1 réaction)</h2>
      <p>Équation: Σ ν<sub>j</sub>A<sub>j</sub> = 0 ; N<sub>out,j</sub> = N<sub>in,j</sub> + ν<sub>j</sub> ξ</p>
      <div class="grid2">
        <div>
          <h3>Alimentation (molaire)</h3>
          <div id="NinBox"></div>
        </div>
        <div>
          <h3>Stœchiométrie</h3>
          <div id="nuBox"></div>
          <h3>Progression</h3>
          <div class="row">
            <input id="xi" type="number" step="any" placeholder="ξ (si connu)">
            <input id="convKey" type="number" step="any" placeholder="Conversion du réactif clé Xc (0–1)">
            <select id="keyComp"></select>
          </div>
          <h3>Si ξ et conversion sont vides</h3>
          <div class="row">
            <select id="specComp"></select>
            <input id="specNout" type="number" step="any" placeholder="N_out du composant choisi">
          </div>
          <small>Astuce: utilise un N_out pour déduire ξ via N_out = N_in + ν·ξ.</small>
        </div>
      </div>
      <button class="primary" id="solveRxn">Calculer</button>
      <div class="result" id="rxnResult"></div>
      <label><input type="checkbox" id="atomCheck"> Vérifier les bilans atomiques (optionnel)</label>
      <div id="atomicsBox" class="mt"></div>
    </section>

    <!-- Multiple reactions -->
    <section class="card unit-panel" id="panel-rxn-multi" hidden>
      <h2>Réactions multiples (ν-matrice)</h2>
      <p>Test d’indépendance (rang de ν). Si indépendant, calcul de N<sub>out</sub> et des fractions molaires.</p>
      <div class="grid2">
        <div>
          <h3>Alimentation (molaire)</h3>
          <div id="NinMultiBox"></div>
          <label>Nombre de réactions R</label>
          <input id="Rcount" type="number" step="1" min="1" value="2">
          <button id="buildNu" class="mt">Construire la matrice ν (R × S)</button>
        </div>
        <div>
          <h3>Matrice stœchiométrique ν (réactions × espèces)</h3>
          <div id="nuMultiBox"></div>
          <h3>Extents  ξ<sub>k</sub></h3>
          <div id="xiBox"></div>

          <h3>Calculer ξ automatiquement (optionnel)</h3>
          <label><input type="checkbox" id="autoXi"> Je veux fournir R spécifications pour résoudre ξ</label>
          <div id="autoXiBox" class="mt"></div>
        </div>
      </div>
      <button class="primary" id="solveRxnMulti">Tester l’indépendance & Calculer</button>
      <div class="result" id="rxnMultiResult"></div>
    </section>

  </main>

  <footer>
    <small>Basé sur vos notes (Ch.1–4). Aucun bilan d’énergie ici.</small>
  </footer>

  <script src="script.js"></script>
</body>
</html>
